<!doctype html>
<html lang="en">
<head>
  <title>Treehouse Logo in three.js</title>
  <meta charset="utf-8">
</head>
<body style="margin: 0;">
<p> Double click to open the box! <a href="index.html">Click here to go back to Giftbox.</a></p> 
  <script src="js/three.min.js"></script>
  <script src="js/OrbitControls.js"></script>
  <script src="js/ColladaLoader.js"></script>
  <script src="js/Tween.js"></script>
  <script>

    // Set up the scene, camera, and renderer as global variables.
    var scene, camera, renderer, box, lid, animateStart=false;

    init();
    animate();

    // Sets up the scene.
    function init() {

      // Create the scene and set the scene size.
      scene = new THREE.Scene();
      var WIDTH = window.innerWidth,
          HEIGHT = window.innerHeight;

      // Create a renderer and add it to the DOM.
      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(WIDTH, HEIGHT);
      document.body.appendChild(renderer.domElement);

      // Create a camera, zoom it out from the model a bit, and add it to the scene.
      camera = new THREE.PerspectiveCamera(45, WIDTH / HEIGHT, 0.1, 20000);
      camera.position.set(10,6,0);
      scene.add(camera);

      // Create an event listener that resizes the renderer with the browser window.
      window.addEventListener('resize', function() {
        var WIDTH = window.innerWidth,
            HEIGHT = window.innerHeight;
        renderer.setSize(WIDTH, HEIGHT);
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
      });

      // Set the background color of the scene.
      renderer.setClearColorHex(0x333F47, 1);
      /*
      var loader = new THREE.ColladaLoader();
      loader.load('models/giftbox.dae', function colladaReady(result) {
        scene.add(result.scene);
        renderer.render(scene,camera);
      });
*/
      // Create a light, set its position, and add it to the scene.
      /*var light = new THREE.PointLight(0xffffff);
      light.position.set(10,20,10);
      scene.add(light);
*/
      hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
        hemiLight.color.setHSL( 0.2, 1, 1 );
        hemiLight.groundColor.setHSL( 0.095, 0, 0.4 );
        hemiLight.position.set( 50, 50, 50 );
        scene.add( hemiLight );

      // Load in the mesh and add it to the scene.
      
      var loader = new THREE.JSONLoader();
      loader.load( "models/box.js", function(geometry,materials){
        //var material = new THREE.MeshLambertMaterial({color: 0x55B663});
        box = new THREE.Mesh( geometry, new THREE.MeshFaceMaterial( materials ) );
        //mesh = new THREE.Mesh(geometry, material);
        scene.add(box);
      });
      
      loader.load( "models/lid.js", function(geometry,materials){
        //var material = new THREE.MeshLambertMaterial({color: 0x55B663});
        lid = new THREE.Mesh( geometry, new THREE.MeshFaceMaterial( materials ) );
        //mesh = new THREE.Mesh(geometry, material);
        scene.add(lid);
      });
      
      //var box = new PinaCollada('giftbox', 1);
      //scene.add(box);
      
      // Add OrbitControls so that we can pan around with the mouse.
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.addEventListener( 'mousemove', controls.onMouseMove, false);

      document.addEventListener( 'dblclick', onDocumentMouseDown, false );


    }
    // Renders the scene and updates the render as needed.
    function animate() {

      // Read more about requestAnimationFrame at http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/
      requestAnimationFrame(animate);
      //lid.rotation.y += 0.001; 
      // Render the scene.

      if(animateStart && lid.rotation.z < .7){
          lid.rotation.z += 0.01;
          lid.position.x += 0.01;
          lid.position.y += 0.02;
        
      }
      if(!animateStart && lid.rotation.z >0){
          lid.rotation.z -= 0.01;
          lid.position.x -= 0.01;
          lid.position.y -= 0.02;
      }
      renderer.render(scene, camera);
      controls.update();

    }

    function onDocumentMouseDown( event ) {
      event.preventDefault();
      animateStart = !animateStart;

      /*
      var rotateY = lid.rotation.y;
      tween = new TWEEN.Tween( rotateY  ).to( 1, 1000 ).easing( TWEEN.Easing.Elastic.EaseOut).start();
      console.log(lid.rotation.y);
      tween.onUpdate(function(){
        lid.rotation.y = rotateY;
      });
      */


      /*
      while(lid.position.x < 3){
        requestAnimationFrame(animate);
        lid.rotation.z += 0.01;
        lid.position.x += 0.01;
        lid.position.y += 0.02;
        renderer.render(scene, camera);

      }*/

        /*
        var vector = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1, 0.5 );
        projector.unprojectVector( vector, camera );

        var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );

        var intersects = raycaster.intersectObjects( objects );

        if ( intersects.length > 0 ) {

          intersects[ 0 ].object.material.color.setHex( Math.random() * 0xffffff );

          var particle = new THREE.Sprite( particleMaterial );
          particle.position = intersects[ 0 ].point;
          particle.scale.x = particle.scale.y = 16;
          scene.add( particle );

        }

        /*
        // Parse all the faces
        for ( var i in intersects ) {

          intersects[ i ].face.material[ 0 ].color.setHex( Math.random() * 0xffffff | 0x80000000 );

        }
        */
      }

  </script>

</body>
</html>
