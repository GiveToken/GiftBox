var imageType=/image.*/;function createVideoImage(e,d,b,c){var a=$('<img class="recruiting-token-video" id="'+e+'">');a.attr("src",d);a.data("url",b);a.data("source",c);a.data("saved",false);return a}function openVimeo(e){var c=vimeoId(e);var a=false;if(c){var b=event.target;$(b).addClass("disable-clicks");var d="https://vimeo.com/api/v2/video/"+c+".json";$.ajax({type:"POST",dataType:"json",url:"/ajax/url-valid",data:{url:d},success:function(f){$.getJSON(d,function(h){var g=createVideoImage(c,h[0].thumbnail_medium,e,"vimeo");createThumbnail(g,"company-video-container")});a=true},error:function(){$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a valid Vimeo URL.")},complete:function(){$(b).removeClass("disable-clicks")}})}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Unable to extract a Vimeo video ID from the URL.")}return a}function openYouTube(c){var e=youTubeID(c);if(e){var d=event.target;$(d).addClass("disable-clicks");var b="https://img.youtube.com/vi/"+e+"/0.jpg";var a=false;$.ajax({type:"POST",dataType:"json",url:"/ajax/url-valid",data:{url:b},success:function(g){if(g.data.httpCode=="200"){var f=createVideoImage(e,b,c,"youtube");createThumbnail(f,"company-video-container");a=true}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a valid Youtube URL.")}},complete:function(){$(d).removeClass("disable-clicks")}});return a}else{$("label").css("color","red");$("#video-dialog-url").attr("label","Unable to extract a Youtube video ID from the URL.");return false}}function processVideoURL(){var a=$("#video-dialog-url").val();var d=false;var c=isYouTube(a);var b=isVimeo(a);if(c){d=openYouTube(a)}else{if(b){d=openVimeo(a)}}if(d){$("#video-dialog")[0].close();$("label").css("color","");$("#video-dialog-url").attr("label","Please choose a Youtube or Vimeo video.")}else{if(!c&&!b){$("label").css("color","red");$("#video-dialog-url").attr("label","Please choose a Youtube or Vimeo video.")}}}function cancelVideoURL(){$("label").css("color","")}function openVideoDialog(){$("#video-dialog-url").val(null);$("#video-dialog")[0].open()}function getDeleted(a){return $("#company-"+a+"-container").data("deleted")}function addDeleted(c,d){var b=$("#company-"+c+"-container");var a=b.data("deleted");a.push(d)}function removeDeleted(b,d){var a=getDeleted(b);var c=a.indexOf(d);a.splice(c,1)}function removeImage(a){var b=a.data("saved");if(b===true){var c=a.data("id");if(a.hasClass("recruiting-token-image")){addDeleted("image",c)}else{if(a.hasClass("recruiting-token-video")){addDeleted("video",c)}}}a.parent().parent().remove()}function removeImageById(a){removeImage($("#"+a))}function createThumbnail(c,e){$("#"+e).removeAttr("hidden");var a=$("<div>");var b=$("<div>");var d=$('<paper-button raised class="remove-button">REMOVE</paper-button>').click(function(){removeImage(c)});b.addClass("inner-thumbnail-container");c.addClass("photo-thumbnail");a.addClass("thumbnail-container");a.attr("id","thumbnail-container-"+($(".thumbnail-container").size()+1));b.append(c);b.append(d);a.append(b);$("#"+e).append(a)}function handleImageFileSelect(a){for(var d=0;d<a.target.files.length;d++){var c=a.target.files[d];if(!c.type.match(imageType)){alert(c.name+" is not an image file (.jpg, .png, etc.).");continue}var b=$('<img class="recruiting-token-image" id="'+c.name.replace(".","_")+'">');b.attr("src",window.URL.createObjectURL(c));b.data("file",c);b.data("saved",false);createThumbnail(b,"company-image-container")}}function uploadFileData(b,d,a){var c=new XMLHttpRequest();if(c.upload){c.upload.onprogress=function(f){if(f.lengthComputable){}};c.open("POST","/upload",true);c.setRequestHeader("X-FILENAME",d);c.send(b);saveTokenImage(a,d)}}function uploadFile(c,d,b){d=typeof d!=="undefined"?d:c.name;var a=new FileReader();a.fileName=d;a.onloadend=function(){uploadFileData(a.result,a.fileName,b)};a.readAsDataURL(c)}function deleteChildren(b){var a=getDeleted(b);a.forEach(function(e){var c="/ajax/recruiting_company_"+b+"/delete/";var d={id:e};$.post(c,d,function(f,g){if(f.status==="SUCCESS"){removeDeleted(b,e)}else{if(f.status==="ERROR"){alert("Recruiting token "+b+" delete failed: "+f.message)}else{alert("Recruiting token "+b+" delete failed: "+g)}}},"json").fail(function(){alert("Recruiting token "+b+" delete failed.")})})}function postSave(a,b,c){$.post(b,c,function(d,e){if(d.status==="SUCCESS"){a.data("id",d.id);a.data("saved",true)}else{if(d.status==="ERROR"){alert("Save failed: "+d.message)}else{alert("Save failed: "+e)}}},"json").fail(function(){alert("Save failed.")})}function saveTokenImage(a,d){a.data("file").name=d;var b="/ajax/recruiting_company_image/save/";var c={recruiting_company_id:a.data("recruiting_company_id"),file_name:d};postSave(a,b,c)}function saveTokenVideo(a){var b="/ajax/recruiting_company_video/save/";var c={recruiting_company_id:a.data("recruiting_company_id"),url:a.data("url"),source:a.data("source"),source_id:a.attr("id")};postSave(a,b,c)}function isValid(e){var a=false;var c=$("#"+e);var b=c[0].value;if(typeof b=="undefined"||!b){var d=c[0].label;$("#validation-message").html(d+" is a required field.");$("#validation-dialog")[0].open()}else{a=true}return a}function linkifyText(){$("#job-title")[0].updateValueAndPreserveCaret(excludedLinkify($("#job-title").val()));$("#job-description")[0].updateValueAndPreserveCaret(excludedLinkify($("#job-description").val()));$("#skills-required")[0].updateValueAndPreserveCaret(excludedLinkify($("#skills-required").val()));$("#responsibilities")[0].updateValueAndPreserveCaret(excludedLinkify($("#responsibilities").val()));$("#perks")[0].updateValueAndPreserveCaret(excludedLinkify($("#perks").val()));if($("#company").length){linkifyCompanyText()}}function linkifyCompanyText(){$("#company")[0].updateValueAndPreserveCaret(excludedLinkify($("#company").val()));$("#company-values")[0].updateValueAndPreserveCaret(excludedLinkify($("#company-values").val()))}function excludedLinkify(b){var a=[{url:"asp.net",temp:"84gt43qg8ci4bci4"},{url:"ASP.NET",temp:"87c84c8n3cgnn7c4"}];a.forEach(function(c){b=b.replace(c.url,c.temp)});b=Autolinker.link(b);a.forEach(function(c){b=b.replace(c.temp,c.url)});return b}function saveRecruitingToken(d){var e=null;var b=null;var a=null;if($("#recruiting-token-form")[0].validate()){linkifyText();setStatus("Saving token...");a=document.getElementById("recruiting-token-form").serialize();var c=event.target;$(c).addClass("disable-clicks");$.post("/ajax/recruiting_token/save/",a,function(h,j){if(h.status==="SUCCESS"){$("#id").val(h.id);$("#long-id").val(h.long_id);var g=h.user_id;var i=h.id;var f=h.recruiting_company_id;if(!$("#recruiting-company-id").length){companyInput='<input type="hidden" id="recruiting-company-id" name="recruiting_company_id" value="'+f+'">';$("#recruiting-token-form").prepend(companyInput)}if(i&&g){if($("#company-images").length){$(".recruiting-token-image").each(function(){var k=$(this);k.data("token_id",i);k.data("recruiting_company_id",f);if(!k.data("saved")){var l=k.data("file");var m=g+"_"+f+"_"+Date.now()+"_"+l.name;k.data("file_name",m);uploadFile(l,m,k)}});deleteChildren("image")}if($("#company-videos").length){$(".recruiting-token-video").each(function(){var k=$(this);k.data("token_id",i);k.data("recruiting_company_id",f);if(!k.data("saved")){saveTokenVideo(k)}});deleteChildren("video")}}closeStatus();if(d){window.open("/token/recruiting/"+h.long_id,"_blank")}}else{if(h.status==="ERROR"){alert(h.message)}else{alert(j)}}$("#save-button").html("Save")},"json").fail(function(){alert("Save failed")}).always(function(){$(c).removeClass("disable-clicks")})}}function saveCompany(){var b=null;var a=null;if($("#recruiting-company-form")[0].validate()){linkifyCompanyText();setStatus("Saving company...");a=document.getElementById("recruiting-company-form").serialize();var c=event.target;$(c).addClass("disable-clicks");$.post("/ajax/recruiting_company/save/",a,function(f,g){if(f.status==="SUCCESS"){$("#id").val(f.id);var e=f.user_id;var d=f.id;if(d&&e){if($("#company-images").length){$(".recruiting-token-image").each(function(){var h=$(this);h.data("recruiting_company_id",d);if(!h.data("saved")){var i=h.data("file");var j=e+"_"+d+"_"+Date.now()+"_"+i.name;h.data("file_name",j);uploadFile(i,j,h)}});deleteChildren("image")}if($("#company-videos").length){$(".recruiting-token-video").each(function(){var h=$(this);h.data("recruiting_company_id",d);if(!h.data("saved")){saveTokenVideo(h)}});deleteChildren("video")}}closeStatus()}else{if(f.status==="ERROR"){alert(f.message)}else{alert(g)}}$("#save-button").html("Save")},"json").fail(function(){alert("Save failed")}).always(function(){$(c).removeClass("disable-clicks")})}}function openToken(){var b=$("#token-to-open");var a=$("#token-to-open")[0].contentElement;a.selected=null;$("#open-dialog")[0].open()}function processOpen(){if($("#open-token-form")[0].validate()){setStatus("Opening token...");var b=$("#token-to-open")[0].contentElement;var a=b.selectedItem.id;$("#open-dialog")[0].close();window.location="/create_recruiting?id="+a}}function chooseCompany(){var b=$("#company-to-use");var a=$("#company-to-use")[0].contentElement;a.selected=null;$("#use-existing-company-dialog")[0].open()}function processCompany(){if($("#use-existing-company-form")[0].validate()){setStatus("Attaching company...");var c=$("#company-to-use")[0].contentElement;var a=c.selectedItem.id;var b=$(c.selectedItem).text();$("#company-info").remove();$("#company-images").remove();$("#company-videos").remove();$("#company-social-media").remove();chosenCard='<input type="hidden" id="recruiting-company-id" name="recruiting_company_id" value="'+a+'">';chosenCard+='<paper-card id="company-info" heading="'+b+'">';chosenCard+="</paper-card>";$("#recruiting-token-form").prepend(chosenCard);$("#use-existing-company-dialog")[0].close();$("#status-dialog")[0].close()}}function setStatus(a){$("#status-message").html(a);$("#status-dialog").css("height","170px");$("#status-dialog")[0].open()}function closeStatus(){$("#status-dialog").css("height","0px");$("#status-dialog")[0].close()}function shrink(a){a.animate({height:"toggle"},1000,function(){})}function fadeIn(a){a.animate({opacity:1},1000,function(){})}function finish(){shrink($("#company-social-media"));shrink($("#company-videos"));shrink($("#company-images"));shrink($("#company-info"));shrink($("#basic-info"));shrink($("#required-info"));$(".bottom-button").each(function(){shrink($(this))});fadeIn($("#send-token-via"))}function backToToken(a){window.location="/create_recruiting?id="+a};