(function(){var d={left:false},g=$(document),f=$("body");g.on("mousedown.left_click",function(){d.left=true});g.on("mouseup.left_click",function(){d.left=false});function e(j,i,h,k){$(j).data("slider",this);this._track=j;this._knob=j.children[0];this._label=this._knob.children[0];this._input=j.children[1];this._min=parseFloat(i||j.dataset.min||0);this._max=parseFloat(h||j.dataset.max||100);this.$this=$(this);this.value(k||j.dataset.value||i);this._is_dragging=false;this._register_events()}e.prototype={value:function(h){if(typeof h!=="undefined"){this._value=parseFloat((h-this._min)/this.range());this._update();this.$this.trigger("change",this.value())}return this.range()*this._value+this._min},range:function(){return this._max-this._min},drag:function(){this._is_dragging=true;f.addClass("App--dragging")},drop:function(){this._is_dragging=false;f.removeClass("App--dragging")},is_dragging:function(){return this._is_dragging},_update:function(){this._knob.style.left=this._value*100+"%";this._input.value=Math.round(this.value());this._label.innerHTML=this._input.value},_update_value:function(h){var i=this._track.getBoundingClientRect(),k=i.left+document.documentElement.scrollLeft,j=i.width;this.value(this.range()*(Math.min(1,Math.max(0,(h-k)/j)))+this._min);this._update()},_register_events:function(){$(this._track).on("mousedown.drag",function(h){this.drag();this._update_value(h.clientX);h.preventDefault()}.bind(this));g.on("mouseup.drop",this.drop.bind(this)).on("mousemove.drag",function(h){if(this.is_dragging()&&d.left){this._update_value(h.clientX)}}.bind(this))}};function c(h){this.$el=$(h);this.$el.data("Form",this);this._$submit=this.$el.find('[type="submit"]');this._$feedback=this.$el.find(".Form__feedback");this._$title=this.$el.find(".Form__title");this._registerEvents()}c.prototype={_registerEvents:function(){this.$el.on("change.Form",".Form__input",function(h){this._updateLabel(h.currentTarget)}.bind(this));this.$el.find(".Form__input").change()},_updateLabel:function(i){var h=$(i).siblings(".Form__label");if(i.value){h.addClass("Form__label--hidden")}else{h.removeClass("Form__label--hidden")}},validate:function(){if(this.$el.find('[data-validation~="required"]').filter(function(j,h){return h.value===""}).length){this.error("All fields required");return false}if(this.$el.find('[data-validation~="email"]').filter(function(j,h){return !h.value.match(/^[^\@]+@[^\@]+\.[^\@\.]+$/)}).length){this.error("Email appears invalid");return false}return true},disableSubmit:function(){this._$submit.attr("disabled",true)},enableSubmit:function(){this._$submit.removeAttr("disabled")},title:function(h){if(typeof h==="string"){this._$title.html(h)}return this._$title.html()},get:function(h){return this.$el.find("#"+h+', [name="'+h+'"]')[0]},set:function(h,i){this.get(h).value=i},error:function(h){this._$feedback.text(h);this.$el.addClass("Form--error")},clearError:function(){this._$feedback.text("");this.$el.removeClass("Form--error")}};function a(h){this._$el=$(h);this._$plan_dialog=$("#plan-dialog");this._$contact_dialog=$("#contact-dialog");this._slider=new e(this._$el.find(".Slider")[0]);this._plans=this._$el.find(".Plan");this._recommended=null;this._planForm=new c(this._$plan_dialog.find(".Form")[0]);this._contactForm=new c(this._$contact_dialog.find(".Form")[0]);this.update_recommendation(this._slider.value());this._register_events()}a.prototype={_register_events:function(){this._slider.$this.on("change",function(i,h){this.update_recommendation(h)}.bind(this));g.on("click.pricing",".Plan__callToAction",function(h){if(h.currentTarget.dataset.plan){this._planForm.set("plan",h.currentTarget.dataset.plan);this._planForm.set("billing",h.currentTarget.dataset.billing);this._planForm.clearError();this._planForm.title($(h.currentTarget).parents(".Plan").find(".Plan__name").text()+' Plan <span class="Form__subtitle">'+h.currentTarget.innerHTML.replace(/<div>.+<\/div>/,"")+"</span>");this._$plan_dialog.modal()}else{this._contactForm.clearError();this._$contact_dialog.modal()}return false}.bind(this));this._planForm.$el.on("submit.pricing",function(){if(this._planForm.validate()){this._planForm.disableSubmit();this._planForm.clearError();Stripe.card.createToken(this._planForm.$el,this._onStripeResponse.bind(this))}return false}.bind(this));this._contactForm.$el.on("submit.pricing",function(){if(this._contactForm.validate()){this._contactForm.disableSubmit();this._contactForm.clearError();$.ajax({url:"/ajax/sendemail",data:this._contactForm.$el.serialize,type:"post"}).done(this._redirectToThankYou("enterprise")).fail(this._onProcessFailure.bind(this))}return false}.bind(this))},_validate_form:function(h){if(h.$el.find('[data-validation~="required"]').filter(function(k,j){return j.value===""}).length){h.error("All fields required");return false}if(h.$el.find('[data-validation~="email"]').filter(function(k,j){return !j.value.match(/^[^\@]+@[^\@]+\.[^\@\.]+$/)}).length){h.error("Email appears invalid");return false}return true},update_recommendation:function(h){var i=this._plans[0];this._plans.each(function(j,k){if(k.dataset.min<=h){i=k}}.bind(this));this.recommend(i)},recommend:function(h){this._recommended=$(h);this._plans.removeClass("Plan--recommended");this._recommended.addClass("Plan--recommended")},_onStripeResponse:function(h,i){if(i.error){this._onProcessFailure(i.error.message)}else{this._signupUser(h,i)}},_signupUser:function(h,i){this._planForm.set("stripeToken",i.id);$.ajax({url:"/ajax/signup",data:{email:this._planForm.get("email").value},type:"post",dataType:"json"}).then(this._upgradePlan.bind(this)).then(this._redirectToThankYou("signup")).fail(this._onProcessFailure.bind(this))},_upgradePlan:function(){return $.ajax({url:"/ajax/upgrade",data:this._planForm.$el.serialize(),type:"post",dataType:"json"})},_redirectToThankYou:function(h){return function(){window.location="/thankyou?action="+h}},_onProcessFailure:function(h){h=typeof h==="string"?h:"There was a problem processing your request. Please try again later.";this._planForm.error(h);this._planForm.enableSubmit()}};var b=new a(document.getElementById("pricing-page"))}());