function loginOpen(){loginClear();$("#login-dialog").modal()}function loginClear(){$("#login-alert-placeholder").html("<div></div>");$("#login_email").val("");$("#password").val("")}function loginClose(){$("#login-dialog").modal("hide")}function loginError(a){$("#login-alert-placeholder").html('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><span>'+a+"</span></div>")}function loginInfo(a){$("#login-alert-placeholder").html('<div class="alert alert-info"><span>'+a+"</span></div>")}function loginSuccess(a){$("#login-alert-placeholder").html('<div class="alert alert-success"><span>You have successfully logged into S!zzle.</span></div>');setTimeout(function(){$("#login-dialog").modal("hide");document.location.href=a},500)}function loginFacebook(){loginInfo("Logging in with Facebook...");FB.login(function(a){handleFBLogin(a)},{scope:"user_photos, public_profile, email"})}function processLogin(a){loginInfo("Logging into S!zzle.  Please wait...");var b=event.target;$(b).addClass("disable-clicks");$.post("/ajax/login",a,function(d,e,c){if(d.status==="SUCCESS"){loginSuccess(d.app_root+"profile")}else{if(d.status==="ERROR"){loginError("Login failed. "+d.message)}else{loginError("Login failed. Unknown return status: "+d.status)}}}).fail(function(){loginError("Login failed.")}).always(function(){$(b).removeClass("disable-clicks")})}function loginEmail(){if(!$("#login_email").val()){loginError("An email address is required when logging in with email.")}else{if(!$("#password").val()){loginError("A password is required when logging in with email.")}else{processLogin($("#login-form").serialize())}}}function handleFBLogin(a){if(a.status==="connected"){FB.api("/me?fields=email,last_name,first_name",function(b){b.login_type="FACEBOOK";b.login_email=b.email;a.email=b.email;a.access_token=FB.getAuthResponse().accessToken;var c=event.target;$(c).addClass("disable-clicks");$.post("ajax/user/update_access_token",a,function(e,f,d){if(e.status==="SUCCESS"){processLogin(b)}else{if(e.status==="ERROR"){loginError("Facebook authorization failed on login.")}else{if(e.status==="NO_USER"){loginError("This Facebook account is not registered. Please use the sign up button to continue.")}}}}).fail(function(){loginError("Facebook authorization failed")}).always(function(){$(c).removeClass("disable-clicks")})})}else{if(a.status==="not_authorized"){loginError("Log In with Facebook failed. Facebook response status: "+a.status)}else{loginError("Log In with Facebook failed. Facebook response status: "+a.status)}}}$("#login_email").keypress(function(a){if(a.which=="13"){loginEmail()}});$("#password").keypress(function(a){if(a.which=="13"){loginEmail()}});